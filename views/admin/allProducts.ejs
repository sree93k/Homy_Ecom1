<%- include('../layout/admin/header')%>
<header>
    <nav class="navbar navbar-expand-lg bg-body-tertiary">
        <div class="container">
            <!-- Left Side - Images -->
            <div class="d-flex align-items-center"> <!-- Added align-items-center class -->
                <div class="headOne">
                    <a class="navbar-brand" href="#">
                        <img src="./images/adminpage/Homy-logos_transparent.png" alt="Logo" width="120"  height="100" class="d-inline-block align-text-top">
                    </a>
                </div>
                <div class="headTwo mx-auto d-flex justify-content-center align-items-center w-100"> <!-- Added w-100 class for 100% width -->
                    <a class="navbar-brand" href="#">
                        <img src="./images/adminpage/homy.png" style="margin-left: 420px" alt="Logo" width="180" height="100" class="d-inline-block align-text-top">
                    </a>
                </div>
            </div>
        </div>
    </nav>
    <nav class="navbar bg-body-warning fixed-top-10px">
        <div class="container mt-2 mb-2">
          <!-- <a class="navbar-brand" href="#">Offcanvas navbar</a> -->
          <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasNavbar" aria-controls="offcanvasNavbar" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvasNavbar" aria-labelledby="offcanvasNavbarLabel">
            <div class="offcanvas-header">
              <h3 class="offcanvas-title mt-3 " id="offcanvasNavbarLabel">Homy Admin Panel</h3>
              <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
            </div>
            <div class="offcanvas-body m-3 ">
                <form class="d-flex mt-3" role="search">
                    <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
                    <button class="btn btn-outline-success" type="submit">Search</button>
                  </form>
              <ul class="navbar-nav justify-content-end flex-grow-1 pe-3 mt-5 ">
                <li class="nav-item">
                  <a class="nav-link active" aria-current="page" href="/admin/dashboard">Dashboard</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link active" aria-current="page" href="/admin/allOrders">All Orders</a>
                  </li>
                <li class="nav-item">
                    <a class="nav-link active" aria-current="page" href="/admin/allUsers">Users</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link active" aria-current="page" href="/admin/allProducts">Products</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link active" aria-current="page" href="/admin/allCategory">Categories</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link active" aria-current="page" href="/admin/allOffers">Offers</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link active" aria-current="page" href="/admin/allCoupons">Coupons</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link active" aria-current="page" href="/admin/allBanners">Banners</a>
                  </li>
                  
              </ul>
              
            </div>
          </div>
          <div class="custom-background d-flex justify-content-between align-items-center">
            <div class="navOne">
              <nav style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb">
                <ol class="breadcrumb">
                  <li class="breadcrumb-item    mt-3 ms-3 "><a href="/admin/dashboard" class="text-light">Dashboard</a></li>
                  <li class="breadcrumb-item active  mt-3 text-light       " aria-current="page">Products</li>
                </ol>
              </nav>
            </div>
            <div class="navTwo d-flex align-items-center">
                <span class="me-3 text-light">Hi, Sreekuttan</span> 
                <form action="/admin/logout"  method="post">
                  <input type="submit" class="btn mt-2 text-light mb-2 " value="Logout">
              </form>
            </div>
        </div>
        </div>
      </nav>
</header>

        <section>
            <div class="container">
             
              <div class="row">
                <div class="cols col-3 d-flex flex-column justify-content-end">
                    <h3>All Products</h3>
                </div>
                <div class="cols col-3 d-flex">
          
                </div>
                <div class="cols col-3 d-flex">
                    <!-- <form class="d-flex mt-3" role="search">
                      <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
                      <button class="btn btn-outline-success" type="submit">Search</button>
                    </form> -->
                </div>
                <div class="cols col-3 d-flex justify-content-end">
                 
                  <a href="/admin/addProducts" class="text-light " ><button type="button" class="btn align text-bg-primary mt-3   text-light rounded-0 ms-auto" id="addNewUser">Add New Product</button></a>
              </div>
            </div>
          
            

              
              <table class="table mt-4">
                  <thead class="table-light">
                    <!-- <th>SI No</th> -->
                    <th>ProductID</th>
                    <th>Image</th>
                    <th>Product</th>
                    <th>Brand</th>
                    <th>Category</th>
                    <th>Description</th>
                    <th>Price</th>
                    <th>Stock</th>
                    <th></th>
                    <th></th>
                  
                  </thead>
                  <tbody>
                  
                    <%
                    if(products.length>0)
                    {
                      for(let i=0;i<products.length;i++)
                      {
                        %>
                        <tr>
                          <!-- <td><%=i+1%></td> -->
                          <td><%= products[i].productIDNumber%></td>
                          <td><img src="./images/adminpage/<%= products[i].productImage[0]%>" alt="<%= products[i].productImage%>" width="50px" height="50px"></td>
                          <td><%= products[i].productName%></td>
                          <td><%= products[i].productBrand%></td>
                          <td><%= products[i].productCategory?.categoryName%></td>
                          <td><%= products[i].productDescription%></td>
                          <td><%= products[i].productPrice%></td>
                          <td><%= products[i].productQuantity%></td>
                         
                            <input type="hidden" name="id" value="<%= products[i]._id %>">
                          <td>
                    
                            <a href="/admin/editProducts?id=<%=products[i]._id%>"><button class="btn btn-success ">Edit</button></a>
                            
                          </td>
                          <td>
                                <button type="button" class="btn bg-danger  text-light  rounded-0 " 
                                data-bs-toggle="modal" data-bs-target="#staticBackdropDelete" 
                                data-product-id="<%= products[i]._id %>" 
                                data-product-name="<%= products[i].productName %>">Delete</button>
                          </td>
                        </tr>
                        <%
                      }
                    }
                    %>
                  
                  </tbody>
                </table>
             </div>
             
    
   
</section>

<section>

<!-- Modal one start - Add Product-->
<div class="modal fade" id="staticBackdropAdd" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content" style="background-color: #f8f9fa; /* Set your desired background color here */">
          <div class="modal-header">
              <h1 class="modal-title fs-5" id="staticBackdropLabel">Add Product</h1>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <form action="/admin/addProducts" method="post" enctype="multipart/form-data">
          <div class="modal-body">
              <div class="mb-3">
                  <input type="text" class="form-control" name="productName" placeholder="Product Name"  required>
              </div>
    
              <div class="mb-3">
                  <select class="form-select border-0" id="ProductCategory" name="productCategory" aria-label="Select Category" >
                      <option value="select" disabled selected>Select Category</option>
                      <option value="Chair">Chair</option>
                      <option value="Bed">Bed</option>
                      <option value="Table">Table</option>
                      <option value="Sofa">Sofa</option>
                  </select>
              </div>
              <div class="mb-3">
                  <input type="number" class="form-control" name="productPrice" placeholder="Price" required>
              </div>
              <div class="mb-3">
                  <input type="number" class="form-control" name="productQuantity" placeholder="Quantity" required>
              </div>
              <div class="mb-3">
                  <input type="text" class="form-control" name="productDescription" placeholder="Description" required>
              </div>
              <div class="mb-3">
                  <input type="file" class="form-control" name="productImage" required>
              </div>
             
          </div>
          <div class="modal-footer d-flex justify-content-center">
            <button type="button" class="btn btn-secondary me-2" data-bs-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#staticBackdropAddSuccess">Submit</button>
        </div>
      </form>
        
      </div>
  </div>
</div>

<!-- Modal one end-->
 <!-- Modal one-success start-->
 <div class="modal fade" id="staticBackdropAddSuccess" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
         
          <div class="modal-body">
              
              <div class="mb-3 row">
                 
                  <div class="col-sm-10">
                      
                      <div class="d-flex flex-wrap">
                          <h4 class="text-success  ">New Prodcut Added Successfully</h4>
                          
                      </div>
                  </div>
              </div>  
          </div>
          <div class="modal-footer d-flex justify-content-center">
             
              <a href="" data-bs-toggle="modal" ><button type="button" class="btn btn-primary " data-bs-dismiss="modal">OK</button></a>
          </div>
         
      </div>
  </div>
</div>

<!-- Modal one-sucess end-->
</section>
<section>

  <!-- Modal two start - Edit Product-->
  <div class="modal fade" id="staticBackdropEdit" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content" style="background-color: #f8f9fa; /* Set your desired background color here */">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="staticBackdropLabel">Edit Product</h1>
                
            </div>
            <form action="/admin/editProducts" method="post" enctype="multipart/form-data">
            <div class="modal-body">
              
                <div class="mb-3">
                    <input type="text" class="form-control" name="productName" placeholder="Products Name" id="ProductName">
                </div>
                <input type="hidden" name="productId" id="ProductId">
                <div class="mb-3">
                    <select class="form-select border-0" id="ProductCategory" name="productCategory" aria-label="Select Category">
                        <option value="select" disabled selected>Select Category</option>
                        <option value="Chair">Chair</option>
                        <option value="Bed">Bed</option>
                        <option value="Table">Table</option>
                        <option value="Sofa">Sofa</option>
                    </select>
                </div>
                <div class="mb-3">
                    <input type="number" class="form-control" name="productPrice" placeholder="Price" id="ProductPrice">
                </div>
                <div class="mb-3">
                    <input type="number" class="form-control" name="productQuantity" placeholder="Quantity" id="ProductQuantity">
                </div>
                <div class="mb-3">
                    <input type="text" class="form-control"  name="productDescription" placeholder="Description" id="ProductDescription">
                </div>
                <div class="mb-3">
                    <input type="file" class="form-control" name="productImage" >
                </div>
              
            </div>
            
            <div class="modal-footer d-flex justify-content-center">
              <button type="button" class="btn btn-secondary me-2" data-bs-dismiss="modal">Cancel</button>
              <button type="submit" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#staticBackdropEditSuccess">Update</button>
          </div>
        </form>
        </div>
    </div>
  </div>
  
  <!-- Modal two end-->
   <!-- Modal two-success start-->
 <div class="modal fade" id="staticBackdropEditSuccess" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
         
          <div class="modal-body">
              
              <div class="mb-3 row">
                 
                  <div class="col-sm-10">
                      
                      <div class="d-flex flex-wrap">
                          <h4 class="text-success  ">Updated Successfully</h4>
                          
                      </div>
                  </div>
              </div>  
          </div> 
          <form action="/admin/allProducts" >
            <div class="modal-footer d-flex justify-content-center">
              <a href="" data-bs-toggle="modal" ><button type="submit" class="btn btn-primary " data-bs-dismiss="modal">OK</button></a>
          </div>
        </form>
      </div>
  </div>
</div>

<!-- Modal two-success end-->
  </section>
  
  <section>
     <!-- Modal three Delete-->
 <div class="modal fade" id="staticBackdropDelete" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        
          <div class="modal-body">
            <h1 class="modal-title fs-5  visually-hidden  "  id="staticBackdropLabel"></h1>
              <div class="mb-3 row">
                 
                  <div class="col-sm-10">
                      
                      <div class="d-flex flex-wrap">
                          <h4 class="text-primary   ">Confirm Delete the Product ?</h4>
                          
                      </div>
                  </div>
              </div>  
          </div>
          <div class="modal-footer d-flex justify-content-center">
            <button type="button" class="btn btn-secondary me-2" data-bs-dismiss="modal">Cancel</button>
           
             <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#staticBackdropDeleteSuccess" id="confirmDeleteButton">Confirm</button></a>
         
          </div>
         
      </div>
  </div>
</div>

<!-- Modal three end-->
  <!-- Modal three-success start-->
  <div class="modal fade" id="staticBackdropDeleteSuccess" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
           
            <div class="modal-body">
                
                <div class="mb-3 row">
                   
                    <div class="col-sm-10">
                        
                      <div class="d-flex flex-wrap justify-content-center text-center">
                        <h4 class="text-success">Deleted Successfully</h4>
                    </div>
                    
                    </div>
                </div>  
            </div> 
              <div class="modal-footer d-flex justify-content-center">
                <a href="" data-bs-toggle="modal" ><button type="button" class="btn btn-primary " data-bs-dismiss="modal">OK</button></a>
           
            </div>
        </div>
    </div>
  </div>
  
  <!-- Modal three-success end-->
  </section>





<script>

  const staticBackdropEdit=document.getElementById('staticBackdropEdit')

  if(staticBackdropEdit)
  {
    staticBackdropEdit.addEventListener('show.bs.modal',event=>{
      const button=event.relatedTarget

      const productId=button.getAttribute("data-product-id")
      const productName=button.getAttribute("data-product-name")
      const productCategory=button.getAttribute("data-product-category")
      const productPrice=button.getAttribute("data-product-price")
      const productQuantity=button.getAttribute("data-product-quantity")
      const productDescription=button.getAttribute("data-product-description")
      const productImage=button.getAttribute("data-product-image")
      
      const modalTitle = staticBackdropEdit.querySelector('.modal-title')
      const ProductNames=staticBackdropEdit.querySelector('#ProductName')

      modalTitle.textContent=`Edit ${productName}`
      ProductId.value=productId
      ProductNames.value=productName
      ProductCategory.value=productCategory
      ProductPrice.value=productPrice
      ProductQuantity.value=productQuantity
      ProductDescription.value=productDescription
      ProductImage.value=productImage
    })
  }


</script>

<script>
  document
    .getElementById("staticBackdropEditSuccess")
    .addEventListener("click", function () {
      // $('#staticBackdrop').modal('show');
      console.log("working");
  
      fetch("/admin/allProducts", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify(),
      })
        .then((response) => response.json())
        .then((data) => {
  
         
          $("#staticBackdropSuccess").modal("show");
        })
        .catch((error) => console.error("Error:", error));
    });
</script>




<script>
  const staticBackdropDelete = document.getElementById('staticBackdropDelete');

  if (staticBackdropDelete) {
    staticBackdropDelete.addEventListener('show.bs.modal', event => {
      const button = event.relatedTarget;
      const productId = button.getAttribute("data-product-id");
      const productName = button.getAttribute('data-product-name');

      const modalTitle = staticBackdropDelete.querySelector('.modal-title');
      const confirmButton = staticBackdropDelete.querySelector('#confirmDeleteButton');
      console.log("hello")
      modalTitle.textContent = `Delete Product ${productName}`;
      console.log(productId+"hello")
      confirmButton.addEventListener('click', () => {
     
        console.log(productId)
        const deleteUrl = `/admin/deleteProduct?id=${productId}`;

        fetch(deleteUrl, {
          method: 'DELETE', 
        })
        .then(response => {
          if (!response.ok) {
            throw new Error(`Error: ${response.status} - ${response.statusText}`);
          }
          return response.json();
        })
        .then(data => {
          console.log(data); 
          window.location.href = '/admin/allProducts'; 
        })
        .catch(error => {
          console.error('Error:', error);
         
        });
      });
    });
  }
</script>
 










<%- include('../layout/admin/footer')%>



