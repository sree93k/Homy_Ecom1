<%- include('../layout/admin/header') %>
<header>
    <nav class="navbar navbar-expand-lg bg-body-tertiary">
        <div class="container">
            <!-- Left Side - Images -->
            <div class="d-flex align-items-center"> <!-- Added align-items-center class -->
                <div class="headOne">
                    <a class="navbar-brand" href="#">
                        <img src="./images/adminpage/Homy-logos_transparent.png" alt="Logo" width="120"  height="100" class="d-inline-block align-text-top">
                    </a>
                </div>
                <div class="headTwo mx-auto d-flex justify-content-center align-items-center w-100"> <!-- Added w-100 class for 100% width -->
                    <a class="navbar-brand" href="#">
                        <img src="./images/adminpage/homy.png" style="margin-left: 400px" alt="Logo" width="180" height="100" class="d-inline-block align-text-top">
                    </a>
                </div>
            </div>
        </div>

    </nav>
    <nav class="navbar bg-body-warning fixed-top-10px">
        <div class="container mt-2 mb-2">
          <!-- <a class="navbar-brand" href="#">Offcanvas navbar</a> -->
          <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasNavbar" aria-controls="offcanvasNavbar" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvasNavbar" aria-labelledby="offcanvasNavbarLabel">
            <div class="offcanvas-header">
              <h3 class="offcanvas-title mt-3 " id="offcanvasNavbarLabel">Homy Admin Panel</h3>
              <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
            </div>
            <div class="offcanvas-body m-3 ">
                <form class="d-flex mt-3" role="search">
                    <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
                    <button class="btn btn-outline-success" type="submit">Search</button>
                  </form>
              <ul class="navbar-nav justify-content-end flex-grow-1 pe-3 mt-5 ">
                <li class="nav-item">
                  <a class="nav-link active" aria-current="page" href="/admin/dashboard">Dashboard</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link active" aria-current="page" href="/admin/allOrders">All Orders</a>
                  </li>
                <li class="nav-item">
                    <a class="nav-link active" aria-current="page" href="/admin/allUsers">Users</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link active" aria-current="page" href="/admin/allProducts">Products</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link active" aria-current="page" href="/admin/allCategory">Categories</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link active" aria-current="page" href="/admin/allOffers">Offers</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link active" aria-current="page" href="/admin/allCoupons">Coupons</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link active" aria-current="page" href="#">Banners</a>
                  </li>
                  
              </ul>
              
            </div>
          </div>
          <div class="custom-background d-flex justify-content-between align-items-center">
            <div class="navOne">
              <nav style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb">
                <ol class="breadcrumb">
                  <li class="breadcrumb-item    mt-3 ms-3 "><a href="/admin/dashboard" class="text-light">Dashboard</a></li>
                  <li class="breadcrumb-item active  mt-3 text-light       " aria-current="page">Banners</li>
                </ol>
              </nav>
            </div>
            <div class="navTwo d-flex align-items-center">
                <span class="me-3 text-light">Hi, Sreekuttan</span> 
                <form action="/admin/logout"  method="post">
                  <input type="submit" class="btn mt-2 text-light mb-2 " value="Logout">
              </form>
            </div>
        </div>
        </div>
      </nav>
    
</header>
<section>

  <section>
    <div class="container">
      <div class="row">
        <div class="cols col-6">
            <h3>All Banners</h3>
        </div>
        <div class="cols col-6 d-flex">
         
          <button type="button" class="btn align text-bg-primary  text-light rounded-0 ms-auto" data-bs-toggle="modal" data-bs-target="#staticBackdropAdd">Add Banner</button>
      </div>
    </div>
      <table class="table mt-5 ">
          <thead class="table-light">
            <th>SI No</th>
            <th>Banner Name</th>
            <th>Description</th>
            <th>Image</th>
            <th>Location</th>
            <th>Position</th>
            <!-- <th>Starting Date</th>
            <th>Expiry Date</th> -->
            <th></th>
            <th></th>
            <th></th>
            
          </thead>
          <tbody>

            <%if(allBanners.length>0)
            {
              for(let i=0;i<allBanners.length;i++)
              {%>
          <tr>
              <td><%=i+1%></td>
              <td><%=allBanners[i].bannerName%></td>
              <td><%=allBanners[i].bannerDescription%></td>
              <td><img src="./images/adminpage/<%=allBanners[i].bannerImage[0]%>" alt="<%=allBanners[i].bannerImage[0]%>" width="100px" height="50px"></td>
              <td>Location</td>
              <td>Position</td>
              <!-- <td><%= allBanners[i].startDate%></td>
              <td><%= allBanners[i].endDate %></td> -->
                <td>
                    <button type="button" class="btn bg-primary  text-light  rounded-0  offerEditBtn" data-banner-id="<%=allBanners[i]._id%>"
                      data-banner-name="<%=allBanners[i].bannerName%>" data-banner-description="<%=allBanners[i].bannerDescription%>" 
                      data-banner-image="<%=allBanners[i].bannerImage%>" data-banner-start="<%=allBanners[i].startDate%>" 
                      data-banner-end="<%=allBanners[i].endDate%>" data-offer-id="<%=allBanners[i]._id%>"
                       data-bs-toggle="modal" data-bs-target="#editBannerModal" >Edit</button>
                </td>
                <td>
                    <button type="button" class="btn bg-danger  text-light  rounded-0  bannerDeleteBtn" data-banner-id="<%=allBanners[i]._id%>" >Delete</button>
                </td>
           </tr>
                <%
              }
            }%>
          </tbody>
        </table>
     </div>
  </section>
</section>

<!-- body end  -->

<!-- modal start -->
<section>
  <!-- Modal one start - Add banner-->
<div class="modal fade" id="staticBackdropAdd" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-dialog-centered">
      <div class="modal-content" style="background-color: #f8f9fa; /* Set your desired background color here */">
          <div class="modal-header">
              <h1 class="modal-title fs-5" id="staticBackdropLabel">Add Banner</h1>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          
          <div class="modal-body">
            <div class="conatiner">
              <div class="row">
                
                <div class="col-6">


                  <div class="mb-3">
                    <label for="">Banner Name</label>
                  <input type="text" class="form-control" id="addName" placeholder="Enter Banner Name">
              </div>
<!-- 
              <div class="mb-3 bannerPageSelection">
                <label for="">Banner Page</label>
                <select class="form-select" aria-label="Default select example" id="bannerPageURL">
                  <option selected>Select Page</option>
                  <option value="Home Page">Home Page</option>
                  <option value="Category Page">Category Page</option>
                
                </select>
              </div>

              <div class="mb-3" id="homeBannerList">
                <label for="">Banner Position</label>
                <select class="form-select" aria-label="Default select example" id="homeBannerPosition">
                  <option selected>Select One</option>
                  <option value="Top Layer">Top Layer</option>
                  <option value="Second Layer">Second Layer</option>
                  <option value="Third Layer">Third Layer</option>
                  <option value="Third Layer">Bottom Layer</option>
                </select>
              </div>

              <div class="mb-3" id="categoryBannerList" >
                <label for="">Banner Position</label>
                <select class="form-select" aria-label="Default select example" id="categoryBannerPosition">
                  <option selected>Select One</option>
                  <option value="Top Layer">Top Layer</option>
                </select>
              </div> -->

            
             
              <!-- <label for="">Banner Dates</label> -->
              <!-- <div class="mb-3 d-flex ">
                <div class="input-group mb-3 w-50">
                  <span class="input-group-text" id="inputGroup-sizing-default">Start Date</span>
                  <input type="date" class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-default" id="startDate">
                </div>
                <div class="input-group mb-3 w-50">
                  <span class="input-group-text" id="inputGroup-sizing-default">End Date</span>
                  <input type="date" class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-default" id="endDate">
                </div>
              </div> -->
              <div class="mb-3 banner-Decription">
                <label for="">Banner Description</label>
                <textarea id="bannerDescription" rows="4" cols="50" placeholder="Enter Description"></textarea>
             </div>
              
           
                </div>
                <div class="col-6 bannerRightSide">
                  <div class="bannerImageShow banner-addimage-preview" id="bannerPreview1"></div>

                  <div class="mb-3 mt-2  ">
                    <input type="file" name="bannerImage" id="bannerImage" class=""  onchange="previewImage(this, 'bannerPreview1')">
                </div>

               
                </div>
              </div>
            </div>
          </div>
          <div class="modal-footer d-flex justify-content-center">
            <button type="button" class="btn btn-secondary me-2" data-bs-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-primary" id="addSubmitBtn"  data-bs-dismiss="modal">Submit</button>
        </div>
     
      </div>
  </div>
</div>
</section>
<!-- Modal add end-->

<section>
  <!-- Modal edit start - Edit Product-->
<div class="modal fade" id="editBannerModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-dialog-centered">
      <div class="modal-content" style="background-color: #f8f9fa; /* Set your desired background color here */">
          <div class="modal-header">
              <h1 class="modal-title fs-5" id="staticBackdropLabel">Edit Banner</h1>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          
          <div class="modal-body">
            <div class="conatiner">
              <div class="row">
                
                <div class="col-6">


                  <div class="mb-3">
                    <label for="">Banner Name</label>
                    <input type="hidden" name="" id="editId">
                    <input type="text" class="form-control" id="editName" placeholder="Enter Banner Name">
                  </div>

              <!-- <label for="">Banner Dates</label> -->
              <!-- <div class="mb-3 d-flex ">
                <div class="input-group mb-3 w-50">
                  <span class="input-group-text" id="inputGroup-sizing-default">Start Date</span>
                  <input type="date" class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-default" id="editStartDate">
                </div>
                <div class="input-group mb-3 w-50">
                  <span class="input-group-text" id="inputGroup-sizing-default">End Date</span>
                  <input type="date" class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-default" id="editEndDate">
                </div>
              </div> -->
              <div class="mb-3 banner-Decription">
                <label for="">Banner Description</label>
                <textarea id="editBannerDescription" rows="4" cols="50" placeholder="Enter Description"></textarea>
             </div>
                </div>

                <div class="col-6 bannerRightSide">
                  <div class="bannerImageShow editimage-preview" id="editBannerPreview"><img src="./images/adminpage/>" alt="" class="img " ></div>
                  <div class="mb-3 mt-2  ">
                    <input type="file" name="bannerImage" id="editBannerImage" class="image-input"  onchange="editPreviewImage(this, 'editBannerPreview')">
         
                </div>

                </div>
              </div>
            </div>
          </div>
          <div class="modal-footer d-flex justify-content-center">
            <button type="button" class="btn btn-secondary me-2" data-bs-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-primary" id="editUpdateBtn"  data-bs-dismiss="modal" >Update</button>
        </div>
     
      </div>
  </div>
</div>
</section>
<!-- Modal edit end-->




 <!-- image add show at ` 1````  -->
 <script>
  function previewImage(input, previewId) {
      const previewContainer = document.getElementById(previewId);
      const file = input.files[0];

      if (file) {
          const reader = new FileReader();

          reader.onload = function () {
              const imageElement = document.createElement("img");
              imageElement.src = reader.result;
              previewContainer.innerHTML = "";
              previewContainer.appendChild(imageElement);
          };
          reader.readAsDataURL(file);
      }
  }
</script>

<!-- edit preview -->
<script>
  function editPreviewImage(input, previewId) {
    console.log("prevoewId is ====",previewId);
    console.log("input is ",input);
      const previewContainer = document.getElementById(previewId);
      console.log("previewContainer",previewContainer);
      const file = input.files[0];
      if (file) {
          const reader = new FileReader();
          reader.onload = function () {
              const existingImage = previewContainer.querySelector('img');
              if (existingImage) {               
                  existingImage.src = reader.result;
              } else {
                  const imageElement = document.createElement("img");
                  imageElement.src = reader.result;
                  imageElement.alt = file.name;
                  imageElement.classList.add('img-fluid', 'mb-2');
                  imageElement.style.height = '200px';
                  imageElement.style.width = '200px';
              
                  previewContainer.innerHTML = "";
                  previewContainer.appendChild(imageElement);
              }
          };
          console.log("the");
          reader.readAsDataURL(file);
      }
  }
</script>


<!-- add banner -->
<script>
  const addSubmitBtn=document.getElementById('addSubmitBtn')

  addSubmitBtn.addEventListener('click',()=>{
    const bannerName=document.getElementById('addName').value
    
    // const startDate=document.getElementById('startDate').value
    // const endDate=document.getElementById('endDate').value
    const fileInput = document.getElementById('bannerImage');
    const bannerDescription=document.getElementById('bannerDescription').value

const file = fileInput.files[0];

let formData = new FormData();
formData.append('bannerImage', file);
formData.append('bannerName', bannerName);
// formData.append('startDate', startDate);
// formData.append('endDate', endDate);
formData.append('bannerDescription', bannerDescription);

fetch('/admin/addBanner', {
    method: 'POST',
    body: formData 
})
.then(response => response.json())
.then(data => {
    console.log(data);
    if(data===true)
    {

      let timerInterval;
      Swal.fire({
        title: "Banner Added Successfully!",
        html: "",
        timer: 600,
        icon:"success",
        timerProgressBar: true,
        didOpen: () => {
          Swal.showLoading();
          const timer = Swal.getPopup().querySelector("b");
          timerInterval = setInterval(() => {
            timer.textContent = `${Swal.getTimerLeft()}`;
          }, 100);
        },
        willClose: () => {
          clearInterval(timerInterval);
        }
      }).then((result) => {
        /* Read more about handling dismissals below */
        if (result.dismiss === Swal.DismissReason.timer) {
          console.log("I was closed by the timer");
        }
      })
      .then(()=>{
        window.location.reload()
      })
    }
    else
    {
      let timerInterval;
      Swal.fire({
        title: "Some Error Occured",
        html: "",
        timer: 600,
        icon:"error",
        timerProgressBar: true,
        didOpen: () => {
          Swal.showLoading();
          const timer = Swal.getPopup().querySelector("b");
          timerInterval = setInterval(() => {
            timer.textContent = `${Swal.getTimerLeft()}`;
          }, 100);
        },
        willClose: () => {
          clearInterval(timerInterval);
        }
      }).then((result) => {
        /* Read more about handling dismissals below */
        if (result.dismiss === Swal.DismissReason.timer) {
          console.log("I was closed by the timer");
        }
      });
    }
})
.catch(error => {
    console.error('Error uploading image:', error);
});
  

  })

</script>




<!-- banner edit preview -->


<script>
  const editBannerModal = document.getElementById('editBannerModal');

  editBannerModal.addEventListener('show.bs.modal', event => {
    const button = event.relatedTarget;

    const bannerId = button.getAttribute("data-banner-id");
    const bannerName = button.getAttribute("data-banner-name");
    const bannerDescription = button.getAttribute("data-banner-description");
    const bannerImage = button.getAttribute("data-banner-image");
    // const startDate = button.getAttribute("data-banner-start");
    // const endDate = button.getAttribute('data-banner-end');

    console.log("bannerId",bannerId);
    console.log("bannerName",bannerName);
    console.log("bannerDescription",bannerDescription);
    console.log("bannerImage",bannerImage);
    // console.log("startdate",startDate);
    // console.log("endDate",endDate);

    const modalTitle = editBannerModal.querySelector('.modal-title');
    const editName = editBannerModal.querySelector('#editName');
    // const editStartDate = editBannerModal.querySelector('#editStartDate');
    // const editEndDate = editBannerModal.querySelector('#editEndDate');
    const editPreview= editBannerModal.querySelector('#editBannerPreview img');
    const editBannerDescription = editBannerModal.querySelector('#editBannerDescription');
    // console.log("start date",startDate);
    // console.log("end date",endDate);
    console.log("name",bannerName);
    modalTitle.textContent = `Edit ${bannerName}`;
    editId.value = bannerId;
    editName.value = bannerName;
    // editStartDate.value = startDate;
    // editEndDate.value = endDate;
    editPreview.src = "./images/adminpage/" + bannerImage; 
    editBannerDescription.value = bannerDescription;
     });
</script>



<!-- edit update btn -->

<script>
  document.addEventListener('DOMContentLoaded',()=>{
    const editUpdateBtn=document.getElementById('editUpdateBtn')

        editUpdateBtn.addEventListener('click',(e)=>{
          e.preventDefault()
          const bannerId = document.getElementById('editId').value;
          const bannerName = document.getElementById('editName').value;
          // const startDate = document.getElementById('editStartDate').value;
          // const endDate = document.getElementById('editEndDate').value;
          const bannerDescription = document.getElementById('editBannerDescription').value;
          const fileInput = document.getElementById('editBannerImage');
          console.log("file input",fileInput);
          const file = fileInput.files[0];
          console.log("bannerName is ",bannerName);
          console.log("file is ",file);

          const formData = new FormData();
          formData.append('bannerImage',file)
          formData.append('bannerId', bannerId);
          formData.append('bannerName', bannerName);
          // formData.append('startDate', startDate);
          // formData.append('endDate', endDate);
          formData.append('bannerDescription', bannerDescription);
          
          console.log(formData);
        fetch(`/admin/editUpadteBanner?bannerId=${bannerId}`,{
          method:'PATCH',
          body:formData
        })
        .then((response)=>response.json())
        .then((data)=>{
          console.log("data received is ",data);
          if(data===true)
          {
            let timerInterval;
          Swal.fire({
            title: "Banner Updated Successfully!",
            html: "",
            timer: 600,
            icon:"success",
            timerProgressBar: true,
            didOpen: () => {
              Swal.showLoading();
              const timer = Swal.getPopup().querySelector("b");
              timerInterval = setInterval(() => {
                timer.textContent = `${Swal.getTimerLeft()}`;
              }, 100);
            },
            willClose: () => {
              clearInterval(timerInterval);
            }
          }).then((result) => {
            /* Read more about handling dismissals below */
            if (result.dismiss === Swal.DismissReason.timer) {
              console.log("I was closed by the timer");
            }
          })
          .then(()=>{
            window.location.reload()
          })
          
          }
        })
        .catch((error)=>{
          console.log(error);
        })
      })
   
  })
</script> 



<!-- delete Banner -->
<script>
  document.addEventListener('DOMContentLoaded',()=>{
    const bannerDeleteBtn=document.querySelectorAll('.bannerDeleteBtn')

    bannerDeleteBtn.forEach(deleteBtn=>{
      deleteBtn.addEventListener('click',()=>{
        const bannerId=deleteBtn.getAttribute('data-banner-id')
      console.log("banner id  is ",bannerId);


      const swalWithBootstrapButtons = Swal.mixin({
          customClass: {
            confirmButton: "btn btn-success",
            cancelButton: "btn btn-danger"
          },
          buttonsStyling: false
        });
        swalWithBootstrapButtons.fire({
          title: "Are you sure to Delete?",
          text: "",
          icon: "warning",
          showCancelButton: true,
          confirmButtonText: "Confirm",
          cancelButtonText: "Cancel",
          reverseButtons: true
        }).then((result) => {
          if (result.isConfirmed) {
            fetch(`/admin/deleteBanner?bannerId=${bannerId}`,{
        method:'DELETE',
      })
      .then((response)=>response.json())
      .then((data)=>{
        console.log(data);
        if(data==true)
        {
          let timerInterval;
          Swal.fire({
            title: "Deleted Successfully!",
            html: "",
            timer: 600,
            icon:"success",
            timerProgressBar: true,
            didOpen: () => {
              Swal.showLoading();
              const timer = Swal.getPopup().querySelector("b");
              timerInterval = setInterval(() => {
                timer.textContent = `${Swal.getTimerLeft()}`;
              }, 100);
            },
            willClose: () => {
              clearInterval(timerInterval);
            }
          }).then((result) => {
            /* Read more about handling dismissals below */
            if (result.dismiss === Swal.DismissReason.timer) {
              console.log("I was closed by the timer");
            }
          })
          .then(()=>{
            window.location.reload()
          })
        }
      })
      .catch((error)=>{
        console.log(error);
      })

            swalWithBootstrapButtons.fire({
              title: "Deleted!",
              text: "Banner has been deleted.",
              icon: "success"
            });
          } else if (
            /* Read more about handling dismissals below */
            result.dismiss === Swal.DismissReason.cancel
          ) {
           
            let timerInterval;
            Swal.fire({
              title: "Delete Cancelled",
              html: "",
              timer: 500,
              timerProgressBar: true,
              didOpen: () => {
                Swal.showLoading();
                const timer = Swal.getPopup().querySelector("b");
                timerInterval = setInterval(() => {
                  timer.textContent = `${Swal.getTimerLeft()}`;
                }, 100);
              },
              willClose: () => {
                clearInterval(timerInterval);
              }
            }).then((result) => {
              /* Read more about handling dismissals below */
              if (result.dismiss === Swal.DismissReason.timer) {
                console.log("I was closed by the timer");
              }
            });
          }
        });



      

      })
      
    })
  })
</script>


<!-- select banner location in adding new banner-->
<script>
  document.addEventListener('DOMContentLoaded',()=>{
    
    var homeBannerList = document.getElementById('homeBannerList');
      var categoryBannerList = document.getElementById('categoryBannerList');
      homeBannerList.style.display = 'none';
      categoryBannerList.style.display = 'none';

    document.getElementById('bannerPageURL').addEventListener('change', function() {
      var selectedOption = this.value;
     

      if (selectedOption === 'Home Page') {
        homeBannerList.style.display = 'block';
        categoryBannerList.style.display = 'none';

      } else if (selectedOption === 'Category Page') {
        categoryBannerList.style.display = 'block';
          homeBannerList.style.display = 'none';
      }
  });

  })
  
</script>



<%- include('../layout/admin/footer') %>