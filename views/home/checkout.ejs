<%- include('../layout/user/header')%>

<link rel="stylesheet" href="/home/styles/home/homeStyle.css">
<header>
    <nav class="navbar navbar-expand-lg bg-body-tertiary">
        <div class="container">
            <!-- Left Side - Images -->
            <div class="d-flex">
                <a class="navbar-brand" href="#">
                    <img src="./images/userpage/Homy-logos_transparent.png" alt="Logo" width="90" height="60" class="d-inline-block align-text-top">
                </a>
                <a class="navbar-brand" href="#">
                    <img src="./images/userpage/homy.png" alt="Logo" width="120" height="60" class="d-inline-block align-text-top">
                </a>
            </div>

            <!-- Center - Navigation Links -->
            <div class="d-flex justify-content-center">
                <div class="container-fluid">
                    <a class="navbar-brand" href="#"></a>
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse" id="navbarNav">
                        <ul class="navbar-nav">
                            <li class="nav-item">
                                <a class="nav-link active" aria-current="page" href="/home">Home</a>
                            </li>
                            <li class="nav-item">
                              <a class="nav-link active" aria-current="page" href="/category">Collections</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link active" aria-current="page" href="#">Projects</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link active" aria-current="page" href="#">Contact</a>
                            </li>
                           
                        </ul>
                    </div>
                </div>
            </div>


            <div class="d-flex ml-auto">
               
                <input type="text" class="form-control m-3" placeholder="Search">
                <%if(locals.loginStatus===false)
                {%>
                  <a href="/login" class="nav-link m-3 ">Login</a>
                  
                  <%} else {%>
                
                    
                    <div class="collapse navbar-collapse" id="navbarNavDarkDropdown">
                        <ul class="navbar-nav">
                          <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                              Hi, <%= userId.name %>
                            </a>
                            <ul class="dropdown-menu dropdown-menu-light dropdown-menu-lg-end" aria-labelledby="navbarDropdownMenuLink">
                              <a href="/userProfile"><li><button class="dropdown-item" id="userProfile" >Profile</button></li></a>
                              <a href="/userOrders"><li><button class="dropdown-item" id="userOrder" >Orders</button></li></a>
                              <a href="/userAddress"><li><button class="dropdown-item" id="userAddress" >Address</button></li></a>
                              <li><hr class="dropdown-divider"></li>
                              <li><button class="dropdown-item" id="userLogout" data-user-userId="<%= userId._id %>">Logout</button></li>
                            </ul>
                          </li>
                        </ul>
                      </div>
                    <%}%>
                
                    <a href="/userWishlist" class="nav-link m-3" ><i class="fa-regular fa-heart fa-lg" style="color: #31415e;"></i></a>
                    <a href="/userCart" class="nav-link m-3 "><i class="fa-solid fa-cart-arrow-down"></i></a>
            </div>
        </div>
    </nav>
</header>

<!-- section -->
<section>
    <div class="cartPage">
        <div class="container">
            <div class="row">
            <div class="col-8 bg-body-secondary  " >
              <div class="cartFirst bg-light  m-2">
               <h3> Checkout</h3>
              </div>
              <!-- <div class="cartSecond  bg-light  m-2">
                Address
              </div> -->
              
                
      
              <section>
                <div class="container  ">
                    <div class="row">

                     <div class="checkBox bg-body-tertiary  ">
                        <div class="addressSection bg-light ">
                          <input type="hidden" value="<%=address%>" id="newAddress">
                          <%if(address){%>
                            <table class="table table-bordered   ">
                         
                            
                                  <tr>
                                <td>
                                <div class="container">
                                  <div class="row">
                                    <div class="col-9">
                                    
                                     <div class="zero">
                                    
                                      <button class="btn btn-success delievryAddress mb-2">Delivery Address</button>
                                     </div>
                                     
                                      <div class="firstLine mb-2 ">      
                                        <h5><%=address.name%>, &nbsp;<%=address.mobile%></h5>                 
                                      </div>
                                      <div class="secondLine">
                                        <p><%=address.name%>, &nbsp;<%=address.address%> &nbsp; <%=address.locality%>,</p>
           
                                      </div>
                                      <div class="thirdLine">
                                        <p><%=address.city%>, &nbsp;<%=address.state%>, &nbsp;<%=address.pincode%>, &nbsp;</p>
                                      </div>
                                      <div class="fourthLine ">
                                        <p>Landmark : <%=address.landmark%>, &nbsp;Alternative Mobile :<%=address.alterMobile%>, &nbsp;</p>
                                      </div>
                                    </div>
                                   
                                    <div class="col-3">
                                      
                                     <button type="button" class="btn btn-outline-primary  ms-5 mt-5 addressChangeBtn" id="addressChange" data-bs-toggle="modal" data-bs-target="#staticChangeAddress">Change</button><br>
                                      
                                    </div>
                                  
                                  </div>
                                </div>
                               
                              </td>
                            </tr>
                    
  
                            </table>
                            <%} else{%>
                              <button type="button" class="btn btn-success mt-3 pt-3 " data-bs-toggle="modal" data-bs-target="#addNewAddress"><h4>Add Delivery Address </h4></button>
                              <%}%>
                                
                          
                    </div>
                    <button class="addAddress "  style="border:none ;width: 100%;" data-bs-toggle="modal" data-bs-target="#addNewAddress">
                
                               <h5 class="text-light ">+ Add New Address</h5>
                   
                  </button>
            <section>
              <div class="container  ">
                  <div class="row">

                   <div class="checkoutBox">
                    
                    <table class="table table-bordered   ">
                   
                      <%if(cartItem.length>0)

                      {
                        for(let i=0;i<cartItem.length;i++)
                        {

                        %>
                        
           
                          <tr class="cartTableRow">
                          
                           
                              
                           
                              <td>
                                <div class="cartItem ">
                                  <div class="cartLevelOne">
                                    <div class="container">
                                      <div class="row">
                                        <div class="col-3">
                                            <img src="../images/adminpage/<%=cartItem[i].productId.productImage[0]%>" width="100px" alt="">
                                            
                                        </div>
                                        <div class="col-9">
                                          <div class="cartInnerOne ms-2" style="text-align: left;">
                                              <h4><%=cartItem[i].productId.productName%></h4>
                                          </div>
                                          <div class="cartInnerTwo">
                                            <div class="container">
                                              <div class="row">
                                                <div class="col-8 " style="text-align: left;">
                                                  <h6><%=cartItem[i].productId.productDescription%></h6>
                                                </div>
                                                <div class="col-4" style="text-align: right;" >
                                                 Price : <%=cartItem[i].productId.productPrice%>
                                                </div>
                                              </div>
                                            </div>
                                        
                                          </div>
                                          <div class="cartInnerThree">
                                            <div class="container">
                                              <div class="row">
                                                <div class="col-3" style="text-align: left;">
                                                  <div class="btn-group">
                                                  
                                                    
                                                    <a href="#" class="btn  text-decoration-none " id="productQuantity" aria-current="page" disabled >Quantity : <%=cartItem[i].quantity%></a>
                                                    
                                                  </div>
                                                </div>
                                                
                                                <div class="col-6" style="text-align: right;">
                                                  
                                                </div>
                                              </div>
                                            </div>
                                          </div>
                                        </div>
                                      </div>
                                    </div>
      
                                  </div>
                                  <hr>
                                  <div class="cartLevelTwo">
                                      <div class="container">
                                        <div class="row">
                                          <div class="col-9">
      
                                          </div>
                  
                                          <div class="col-3">
                                            Sub Total : <%=cartItem[i].totalPrice%>
                                          </div>
                                        </div>
                                      </div>
                                  </div>
                                </div>
                             
                               
                              </td>

                          
                    </tr>
                  
                    <%}
                  }%>
           
                    </table>
                    

                  </div>
                  </div>
              </div>
           




            </section>

            <!-- section 3rd start-->

            <section>
              <div class="paymentMethod">
                
                <div class="accordion accordion-flush" id="accordionFlushExample">
                  <div class="PaymentHead">
                    <h5>Payment Method</h5>
                  </div>
                  <div class="accordion-item">
                    <h2 class="accordion-header">
                      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseOne" aria-expanded="false" aria-controls="flush-collapseOne">
                        <i class="fa-regular fa-credit-card me-3"></i>Online Payment
                      </button>
                    </h2>
                    <div id="flush-collapseOne" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">
                      <div class="accordion-body" style="display: flex;flex-direction: column; text-align: left;">
                        <div class="onlinePayment">
                          <input type="radio" value="netBanking" class="me-3" name="paymentMethod" id="netBanking">
                          <label for=""><i class="fa-regular fa-credit-card"></i>Net banking  </label><br>
                        </div>
                        
                      </div>
                    </div>
                  </div>
                  <div class="accordion-item">
                    <h2 class="accordion-header" >
                      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwo" aria-expanded="false" aria-controls="flush-collapseTwo">
                        <i class="fa-solid fa-wallet me-3"></i> Wallet
                      </button>
                    </h2>
                    <div id="flush-collapseTwo" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">
                      <div class="accordion-body" style="display: flex; justify-content:left">
                        <input type="radio" value="walletPayment" class="me-3" name="paymentMethod" id="walletPayment">
                        <label for=""><i class="fa-solid fa-wallet"></i> Wallet</label>
                      </div>
                    </div>
                  </div>
                  <div class="accordion-item">
                    <h2 class="accordion-header">
                      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseThree" aria-expanded="false" aria-controls="flush-collapseThree">
                          <span class="material-symbols-outlined me-3">
                            payments
                            </span> Cash On Delivery
                      </button>
                    </h2>
                    <div id="flush-collapseThree" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">
                      <div class="accordion-body" style="display: flex;justify-content: left;">
                          <input type="radio" value="cashOnDelivery" class="me-3" name="paymentMethod" id="cashOnDelivery">
                          <label for=""><span class="material-symbols-outlined">
                            payments
                            </span>Cash On dlivery</label>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </section>
            <div class="orderConfirm mb-4">
              <button type="button" class="btn btn-success btn-lg" id="orderConfirmBtn"><h4 class="mt-2">Proceed To Confirm Order</h4></button>
            </div>

            <!-- section 3rd last -->

                    </div>
                    </div>
                </div>
             
              </section>
            </div>
          

            <!-- right side -->
            <div class="col-4  " style="background-color: #355d87; display: flex;flex-direction: column; ">
              <div class="card cartPriceDetails" style="margin: 2rem; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1)">
                <h4 class="card-header">Coupons</h4>
                <div class="card-body">
                  <table class="table ">
                    <tr>
                      <td>
                        <div class="d-flex align-items-center coupons border border-primary p-3  ">
                          <h6 class="mr-3 mb-0">Apply Coupon</h6>
                          <button type="button" class="btn btn-primary btn-sm ms-3 w-50" style="height: 30px;" id="applyCouponBtn" data-bs-toggle="modal" data-bs-target="#couponModal">Check</button>
                        </div>
                        
                      </td>

                    </tr>
                  </table>
                  <%if(applycouponData!=0)
                  {%>
                  <div class="selectedDiv d-flex" style="margin-left: 0px;" >
                    <button type="button" class="selectedCoupon " style="background-color: transparent; border:transparent; color:black; margin-left:20px" disabled >
                    Applied Coupon <button type="button" class="btn btn-outline-primary m-1" style="--bs-btn-padding-y: .25rem; --bs-btn-padding-x: .5rem; --bs-btn-font-size: .75rem;width: 80px;"><%= applycouponData.couponId %> </button></button>
                    <button type="button" id="removeCouponIcon" class="removeCoupon me-3 ms-3 " style="background-color: transparent; border:transparent; " data-coupon-id="<%= applycouponData._id %>"><i class="fa-solid fa-trash"></i></button>
                  </div>
                  <%}%>
                </div>
               
                
              </div>

              <!-- border -->
              <div class="card cartPriceDetails" style="margin: 2rem; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1)">
                <h4 class="card-header">Price Details</h4>
                <div class="card-body">
                  
                 
                  <table class="table border-1 border-black ">
                    <tr>
                      <th scope="row">Price</th>
                      <td>₹ <%= totalPrice %></td>
                    </tr>
                    <tr>
                      <th scope="row">Coupon Discount</th>
                      <td>
                        <% if (applycouponData !== 0) { %>
                          ₹ <%= applycouponData.discountValue %>
                        <% } else { %>
                          ₹ <%= applycouponData %>
                        <% } %>
                      </td>
                    </tr>
                    <tr>
                      <th scope="row">Offer Discount</th>
                      <td><i class="fas fa-minus-circle"></i>₹ 0</td> </tr>
                    <tr>
                      <th scope="row">Delivery Charges</th>
                      <td><i class="fas fa-truck"></i>₹<h6 class="deliveryCharge" id="deliveryCharge"><%=deliveryCharge%></h6></td> </tr>
                    <tr>
                      <th scope="row"><h4>Total Amount</h4></th>
                      <input type="hidden" id="totals" value="<%= userId.totalCart %>">
                      <td><h4>₹ <%= totalCart %></h4></td>
                    </tr>
                  </table>
                
                </div>
               
                
              </div>
             
            </div>
            
            </div>
        </div>
    </div>
</section>


<!-- //modal -->



  <!-- Modal address start-->
<div class="modal fade" id="staticChangeAddress" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="staticBackdropLabel">Select Address</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="container">
          <% if (allAddress.length > 0) { %>
            <% for (let i = 0; i < allAddress.length; i++) { %>
              <div class="card mb-4"> 
                <div class="card-header">
                  <h5><%= allAddress[i].name %>, &nbsp;<%= allAddress[i].mobile %></h5>
                </div>
                <div class="card-body">
                  <p><%= allAddress[i].address %>, &nbsp;<%= allAddress[i].locality %></p>
                  <p><%= allAddress[i].city %>, &nbsp;<%= allAddress[i].state %>, &nbsp;<%= allAddress[i].pincode %></p>
                  <p>Landmark: <%= allAddress[i].landmark %>, &nbsp;Alternative Mobile: <%= allAddress[i].alterMobile %></p>
                </div>
                <div class="card-footer">
                  <input type="radio" name="addressSelection" id="addressSelector" value="<%= allAddress[i]._id %>">
                  <label for="address-<%= i %>">Select</label>
                </div>
              </div>
            <% } %>
          <% } else { %>
            <p class="text-center">No addresses found.</p>
          <% } %>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary" id="addressSelectorBtn">Select</button>
      </div>
    </div>
  </div>
</div>


  <!-- Modal address end-->


  <!-- coupon modal starting -->

<!-- Modal coupon -->
<div class="modal fade" id="couponModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Coupons</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
       
        <input type="hidden" id="modalCouponData">

        <% if (couponData.length > 0) {
          for (let i = 0; i < couponData.length; i++) { %>
            <div class="mainCoupons bg-body-secondary mb-3">
              <div class="couponRow d-flex align-items-center">
                <div class="couponsFirst" style="width: 40px;">
                  <input type="radio" class="d-block mx-auto couponRadio" name="couponSelection" value="<%= couponData[i]._id %>">
                </div>
                <div class="couponsSecond d-flex flex-column" style="width:300px">
                  <button type="button" class="btn btn-outline-primary m-1" style="--bs-btn-padding-y: .25rem; --bs-btn-padding-x: .5rem; --bs-btn-font-size: .75rem;width: 80px;"><%= couponData[i].couponId %> </button>
                  <h6 class="couInner">₹ <%= couponData[i].discountValue %></h6>
                  <p class="couInner small"><%= couponData[i].couponDescription %></p>
                </div>
                <div class="couponsLast" style="width: 200px;">
                  <div class="news d-flex">
                    <p class="couInner small">Expiry Date : </p>
                    <p class="couInner small starting-date"><%= couponData[i].expiryDate %></p>
                  </div>
                </div>
              </div>
            </div>
        <% }
        } %>
        
      </div>
      <div class="modal-footer">
        
        <button type="button" class="btn btn-primary" data-bs-dismiss="modal" id="couponConfirmedBtn">Apply</button>
      </div>
    </div>
  </div>
</div>
   <!-- coupon modal ending -->


   <!-- Button trigger modal -->

<!-- Modal -->
<div class="modal fade" id="addNewAddress" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="exampleModalLabel">Add New Address</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <section>
          <form>
            <div class="container">
              <div class="row">
                <div class="col-md-6">
                  <div class="form-floating mb-3">
                    <input type="text" class="form-control" id="userName" name="userName">
                    <label for="userName">Name</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating mb-3">
                    <input type="text" class="form-control" id="userMobile">
                    <label for="userMobile">Mobile</label>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-md-6">
                  <div class="form-floating mb-3">
                    <input type="text" class="form-control" id="userPincode">
                    <label for="userPincode">Pincode</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating mb-3">
                    <input type="text" class="form-control" id="userLocality">
                    <label for="userLocality">Locality</label>
                  </div>
                </div>
              </div>
              <div class="form-floating mb-3">
                <input type="text" class="form-control" id="address">
                <label for="address">Flat / House no. / Area / Street</label>
              </div>
              <div class="row">
                <div class="col-md-6">
                  <div class="form-floating mb-3">
                    <input type="text" class="form-control" id="userCity">
                    <label for="userCity">City / District / Town</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating mb-3">
                    <input type="text" class="form-control" id="userState">
                    <label for="userState">State</label>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-md-6">
                  <div class="form-floating mb-3">
                    <input type="text" class="form-control" id="userLandmark">
                    <label for="userLandmark">Landmark (Optional)</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating mb-3">
                    <input type="text" class="form-control" id="userAltMobile">
                    <label for="userAltMobile">Alternative Phone (Optional)</label>
                  </div>
                </div>
              </div>
              <div class="form-group">
                <label>Address Type</label>
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="radio" name="addressType" id="addressTypeHome" value="Home">
                  <label class="form-check-label" for="addressTypeHome">Home</label>
                </div>
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="radio" name="addressType" id="addressTypeOffice" value="Office">
                  <label class="form-check-label" for="addressTypeOffice">Office</label>
                </div>
              </div>
              <div class="row">
                <div class="col-md-6">
                  <button type="button" class="btn btn-light mb-3 mt-3 w-100 border-primary border-3">Cancel</button>
                </div>
                <div class="col-md-6">
                  <button type="button" class="btn btn-primary mb-3 mt-3 w-100" id="addressSaveBtn">Save</button>
                </div>
              </div>
            </div>
          </form>
        </section>
      </div>
    </div>
  </div>
</div>




<!-- user logout -->

<script>
  document.getElementById('userLogout')
  .addEventListener('click',()=>{
   
    fetch('/logout',{
      method:'POST',
      headers: {
          "Content-Type": "application/json",
        },
    })
    .then((response) => response.json())
      .then((data) => {
        console.log(data)
        Swal.fire({
          title: "Logout Successfully !",
          icon: "success"
        })
        .then(() => {
          window.location.href = '/';
          });
      })
      .catch((error)=>{
        console.log(error)
      })

  })
</script>


<!-- toast script -->
<script>
  const toastTrigger = document.getElementById('liveToastBtn')
const toastLiveExample = document.getElementById('liveToast')

if (toastTrigger) {
  const toastBootstrap = bootstrap.Toast.getOrCreateInstance(toastLiveExample)
  toastTrigger.addEventListener('click', () => {
    toastBootstrap.show()
  })
}
</script>

<!-- toast script -->

   <!-- script starting -->
  <script>
    const addressSelectorBtn = document.getElementById('addressSelectorBtn');

    addressSelectorBtn.addEventListener('click', () => {
        let addressId;
        const selectedAddress = document.querySelector('input[name="addressSelection"]:checked');
        if (selectedAddress) {
            addressId = selectedAddress.value;
        } else {
            // Handle case where no address is selected
            console.log("No address selected.");
            return;
        }

        console.log("Selected address ID:", addressId);

        fetch('/addressSelection', {
            method: 'post',
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({ address: addressId })
        })
        .then((response) => response.json())
        .then((data) => {
            console.log(data);
            window.location.reload()
        })
        .catch((error) => {
            console.log(error);
        });
    });
</script>



<!-- razorpay library-->
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>

<!-- payment cashondelivery and onlinepayment  -->
<script>
  const orderConfirmBtn=document.querySelectorAll('#orderConfirmBtn')
 const totalValue=document.getElementById('totals').value
 console.log("totalValue is", totalValue);
 const deliveryCharge=Number(document.getElementById('deliveryCharge').textContent)
 console.log("delievry charge",deliveryCharge);
  orderConfirmBtn.forEach(orderConfirmBtn => {
  orderConfirmBtn.addEventListener('click',()=>{
    let orderMethod;
    if(document.getElementById('cashOnDelivery').checked)
    {
      orderMethod=document.getElementById('cashOnDelivery').value
      orderRoute="cashOnDelivery"
    }
    else if(document.getElementById('netBanking').checked)
    {
      orderMethod=document.getElementById('netBanking').value
      orderRoute='netBanking'
    }
    else if(document.getElementById('walletPayment').checked)
    {
      orderMethod=document.getElementById('walletPayment').value
      orderRoute='walletPayment'
    }
    else
    {
      Swal.fire({
            title: "Checkout Payment Method",
            icon: "error"
          })
          .then(() => {
            setTimeout(() => {
            // window.location.reload();
          }, 2000);
            });

    }
    const addressExist=document.getElementById('newAddress').value
    console.log("new address",addressExist);
    if(!addressExist)
    {
      Swal.fire({
            title: "Add New Address",
            icon: "error"
          })
          .then(() => {
            setTimeout(() => {
            // window.location.reload();
          }, 2000);
            });
    }
    else
    {
      console.log(orderMethod);
      if(orderMethod==="cashOnDelivery" && totalValue>10000)
      {
        let timerInterval;
        Swal.fire({
          title: "Above ₹10000 cannot be Cash on Delivery",
          html: "",
          timer: 2000,
          timerProgressBar: true,
          didOpen: () => {
            Swal.showLoading();
            const timer = Swal.getPopup().querySelector("b");
            timerInterval = setInterval(() => {
              timer.textContent = `${Swal.getTimerLeft()}`;
            }, 100);
          },
          willClose: () => {
            clearInterval(timerInterval);
          }
        }).then((result) => {
          /* Read more about handling dismissals below */
          if (result.dismiss === Swal.DismissReason.timer) {
            console.log("I was closed by the timer");
          }
        });
      }
      else
      {
        fetch(`/${orderRoute}`,{
  method:"POST",
  headers:{
    "Content-Type":"application/json"
  },
  body:JSON.stringify({paymentMethod:orderMethod,deliveryCharge:deliveryCharge})
})
.then((response)=>response.json()
.then((data)=>{
  console.log("success order");
  console.log(data);
  if(data[1]==="cashOnDelivery")
  {
    if(data[0])
  {
    Swal.fire({
        title: "Order Done Successfully",
        icon: "success"
      })
      .then(() => {
        window.location.href = '/orderConfirmed';
        });
  }
  else
  { 
    Swal.fire({
        title: "Order Failed",
        icon: "error"
      })
      .then(() => {
        window.location.reload();
        });

  }

  }
  else if(data[1]==="onlinePayment")
  {
    if(data[0]===true)
    {
      console.log("online paymentt retrun orderId successfuly");
    const order=data[2]
    console.log(" order is....",order);
    razorpayPayment(order);
    console.log("1st funtion last line");
    }
    else
    {
      console.log("online error");
    }

  }
  else   if(data[1]==="walletPayment")
  {
    if(data[0])
  {
    Swal.fire({
        title: "Order Done Successfully",
        icon: "success"
      })
      .then(() => {
        window.location.href = '/orderConfirmed';
        });
  }
  else
  {
   
    
    Swal.fire({
        title: "No Enough Balance In Your Wallet !",
        icon: "error"
      })
      .then(() => {
        window.location.reload();
        });

  }

  }
 
  
}))
.catch((error)=>{
  console.log(error);
})
        
      }


    }

  })
  })

function razorpayPayment(order)
{
  console.log("razor pay first funtion called..");
  console.log(typeof(order.amount));
  var options = {
    "key": "rzp_test_HMZrUgnBYupd2b", 
    "amount": order.amount, 
    "currency": "INR",
    "retry":false,
    "name": "Homy Furnitures",
    "description": `Order ID :${order.receipt} `,
    "image": "https://example.com/your_logo",
    "order_id": order.id, 
    "handler": function (response){
        // alert(response.razorpay_payment_id);
        // alert(response.razorpay_order_id);
        // alert(response.razorpay_signature)
        verifyPayment(response,order)
    },
    "prefill": {
        "name": "Gaurav Kumar",
        "email": "gaurav.kumar@example.com",
        "contact": "9000090000"
    },
    "notes": {
        "address": "Razorpay Corporate Office"
    },
    "theme": {
        "color": "#3399cc"
    }
};
var rzp = new Razorpay(options);

rzp.on('payment.failed', function (response) {
            console.log(response.error.code);
            console.log(response.error.description);
            console.log(response.error.source);
            console.log(response.error.step);
            console.log(response.error.reason);
            console.log(response.error.metadata.order_id);
            console.log(response.error.metadata.payment_id);
            //paymentObject.close();
            Swal.fire({
                title: "Payment Failed",
                text: "Payment failed, please try again",
                icon: "error"
            })
            .then(()=>{
              window.location.href='/userOrders'
            })
           
        })

  rzp.open();
}

function verifyPayment(payment,order)
{
  console.log("2nd funtion listeningg....");
  console.log("payment",payment);
  console.log("order",order);
  $.ajax({
    url:'/verifyPayment',
    data:{
      payment,
      order
    },
    method:'POST',
    success:function(data){
      console.log("success data is ",data);
      if(data[1]==="onlinePayment")
      {
        if(data[0])
      {
        Swal.fire({
            title: "Order Done Successfully",
            icon: "success"
          })
          .then(() => {
            window.location.href = '/orderConfirmed';
            });
      }
      else
      {
        Swal.fire({
            title: "Order Failed",
            icon: "error"
          })
          .then(() => {
            window.location.reload();
            });

      }

      }
    },
    error:function(error){
      console.error("error occured while making ajax",error)
    }
  })
  console.log("2nd function end....");
}

</script>
 

<!-- time/date  set up -->

<script>

  document.addEventListener('DOMContentLoaded', () => {
    function formatDate(date) {
      const d = new Date(date);
      const day = d.getDate().toString().padStart(2, '0');
      const month = (d.getMonth() + 1).toString().padStart(2, '0'); 
      const year = d.getFullYear();
      return `${day}/${month}/${year}`;
    }

    const startingDateCells = document.querySelectorAll('.starting-date');
    startingDateCells.forEach(cell => {
      const date = cell.textContent.trim();
      if (date) {
        cell.textContent = formatDate(date);
      }
    });
  });
  
</script>

<!-- apply coupon  -->
<script>
  const applyCouponBtn=document.getElementById('applyCouponBtn')

  applyCouponBtn.addEventListener('click',()=>{
    console.log("applyCouponBtn started");
    fetch('/applyCoupon',{
      method:'GET',

    })
    .then((response)=>response.json())
    .then((data)=>{
      console.log(data);
      if(data)
      {
        $("#couponModal1").modal("show");
      }
    })
    .catch((error)=>{
      console.log(error);
    })
  })
</script>

<!-- select coupon -->
<script>
  document.addEventListener('DOMContentLoaded',()=>{
    const couponBtn=document.getElementById('couponConfirmedBtn')

    couponBtn.addEventListener('click', () => {
      const radioButtons = document.querySelectorAll('input[name="couponSelection"]');
      let selectedCouponId = null;

   
      radioButtons.forEach(radioButton => {
        if (radioButton.checked) {
          selectedCouponId = radioButton.value;
        }
      });

   
      if (selectedCouponId) {
        console.log("Selected coupon ID:", selectedCouponId);
        fetch('/addOnCoupon',{
          method:"POST",
          headers:{
            "Content-Type":"application/json"
          },
          body:JSON.stringify({couponId:selectedCouponId})
        })
        .then((response)=>response.json())
        .then((data)=>{
          console.log(data);
          console.log("success data received");
          window.location.reload()

        })
        .catch((error)=>{
          console.log(error);
        })
      
      } else {
        console.log("No coupon selected");
        
      }
    });

    
  })

</script>


<!-- remove coupon -->
<script>
  const removeCouponBtn=document.getElementById('removeCouponIcon')

  removeCouponBtn.addEventListener('click',()=>{
    const couponId=removeCouponBtn.getAttribute('data-coupon-id')
    console.log("couponId is ",couponId);
    fetch('/removeCoupon',{
      method:'POST',
      headers:{
        "Content-Type":"application/json"
      },
      body:JSON.stringify({couponId:couponId})
    })
    .then((response)=>response.json())
    .then((data)=>{
      console.log(data);
      window.location.reload()
    })
    .catch((error)=>{
      console.log(error);
    })
  })
</script>

<!-- sctipt address save -->
<script>
  //  document.addEventListener('DOMContentLoaded', function () {
    const addressSaveBtn=document.getElementById('addressSaveBtn')
  console.log("address add start");
    addressSaveBtn.addEventListener('click',()=>{
      console.log("address clicked");
     let addressType;
      if(document.getElementById('addressTypeHome').checked)
     {
      addressType=document.getElementById('addressTypeHome').value
     }
     else if(document.getElementById('addressTypeOffice').checked)
     {
      addressType=document.getElementById('addressTypeOffice').value
     }

     userName=document.getElementById('userName').value
        userMobile=document.getElementById('userMobile').value
        userPincode=document.getElementById('userPincode').value
        userLocality=document.getElementById('userLocality').value
        userAddress=document.getElementById('address').value
        userCity=document.getElementById('userCity').value
        userState=document.getElementById('userState').value
        userLandmark=document.getElementById('userLandmark').value
        userAltMobile=document.getElementById('userAltMobile').value

const nameRegix=/^[a-zA-Z]+(?:\s[a-zA-Z]+)?$/;
const numberRegix=/^\d{10}$/;
const pincodeRegix=/^\d{6}$/;
const emptyRegix= /^\s*$/;
if(nameRegix.test(userName)===true && emptyRegix.test(userName)===false)
{
if(numberRegix.test(userMobile)===true && emptyRegix.test(userMobile)===false && numberRegix.test(userAltMobile)===true && emptyRegix.test(userAltMobile)===false)
{
  if(pincodeRegix.test(userPincode)===true)
  {
      
      const UserAddress={
          userName:document.getElementById('userName').value,
          userMobile:document.getElementById('userMobile').value,
          userPincode:document.getElementById('userPincode').value,
          userLocality:document.getElementById('userLocality').value,
          userAddress:document.getElementById('address').value,
          userCity:document.getElementById('userCity').value,
          userState:document.getElementById('userState').value,
          userLandmark:document.getElementById('userLandmark').value,
          userAltMobile:document.getElementById('userAltMobile').value,
          addressType:addressType
          
      }
    
     console.log(UserAddress);
     fetch('/addAddress',{
      method:'POST',
      headers:{
        "Content-Type":"application/json"
      },
      body: JSON.stringify(UserAddress)
     })
     .then((response)=>response.json())
     .then((data)=>{
      console.log(data);
      if(data[0])
      {
        console.log("success save");
        console.log(data);
        let timerInterval;
        Swal.fire({
          title: "Successfully Added !",
          html: "",
          icon:"success",
          timer: 600,
          timerProgressBar: true,
          didOpen: () => {
            Swal.showLoading();
            const timer = Swal.getPopup().querySelector("b");
            timerInterval = setInterval(() => {
              timer.textContent = `${Swal.getTimerLeft()}`;
            }, 100);
          },
          willClose: () => {
            clearInterval(timerInterval);
          }
        }).then((result) => {
          /* Read more about handling dismissals below */
          if (result.dismiss === Swal.DismissReason.timer) {
            console.log("I was closed by the timer");
          }
        })
        .then(()=>{
          window.location.reload()
        })
      
      }
      else
      {
        console.log("failed save");
        console.log("success save");
        console.log(data);
        let timerInterval;
        Swal.fire({
          title: "Some Error Occured",
          html: "",
          icon:"error",
          timer: 600,
          timerProgressBar: true,
          didOpen: () => {
            Swal.showLoading();
            const timer = Swal.getPopup().querySelector("b");
            timerInterval = setInterval(() => {
              timer.textContent = `${Swal.getTimerLeft()}`;
            }, 100);
          },
          willClose: () => {
            clearInterval(timerInterval);
          }
        }).then((result) => {
          /* Read more about handling dismissals below */
          if (result.dismiss === Swal.DismissReason.timer) {
            console.log("I was closed by the timer");
          }
        })
        .then(()=>{
          window.location.reload()
        })
      }
     
     })
     .catch((error)=>{
      console.log(error);
      console.log("error failed");
     })

    }
  else
  {
    Swal.fire({
  title: "Incorrect Pincode",
  text: "",
  icon: "error"
});

  }

}
else
{
  Swal.fire({
  title: "Incorrect Number",
  text: "",
  icon: "error"
});

}

}
else
{
  Swal.fire({
  title: "Enter Correct Name",
  text: "",
  icon: "error"
});
}
      
    })
  //  })
  </script>
  


 
<%- include('../layout/user/footer')%>
